<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Momentum – Deck Counter</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<style>
/* ---------- existing styles ---------- */
body{margin:0;font-family:sans-serif;background:#222;color:#fff;text-align:center}
.card{display:inline-block;width:85px;height:120px;border-radius:8px;margin:4px;padding:6px;border:2px solid #ccc;cursor:pointer}
.red{background:#8a1b1b}.blue{background:#0d2a86}.ump{background:#555}.wild{background:#333}
/* ---------- deck card-back ---------- */
.back{background:#444;border-color:#999;display:flex;justify-content:center;align-items:center}
.back span{font-weight:700;color:#eee;font-size:13px}
.deck-area{display:flex;flex-direction:column;align-items:center;margin:8px 0}
.card-title{font-size:14px;font-weight:700}.card-val{font-size:20px;margin-top:6px}
.board{display:flex;flex-direction:column;height:100vh}
.hand-bar{background:#111;border-top:2px solid #444;padding:6px}
.hand{display:flex;justify-content:center;flex-wrap:wrap}
.zone{flex:1;margin:4px;border:2px solid #555;border-radius:10px;padding:6px;background:#333}
.highlight{border-color:#ffcc00;box-shadow:0 0 8px #ffcc00}
.chain{display:flex;justify-content:center;flex-wrap:wrap;margin-top:4px}
.btn{padding:12px 24px;margin:8px auto;font-weight:700;border:none;border-radius:8px;cursor:pointer;background:#ffcc00;color:#000}
.start{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#f9f0ee;color:#0d2a86}
.start h1{color:#8a1b1b}
.splash-card{width:240px;max-width:80%;margin-bottom:20px;border-radius:6px;box-shadow:0 0 10px rgba(0,0,0,.25)}
.start button{background:#8a1b1b;color:#f9f0ee;padding:14px 32px;font-size:20px;font-weight:700;border:none;border-radius:10px;cursor:pointer}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect}=React;
const shuffle=a=>[...a].sort(()=>Math.random()-0.5);
const last=a=>a.length?a[a.length-1]:null;

/* ----- deck builder (same) ----- */
const COLORS=["red","blue"];
const MOM={Handball:8,Bounce:8,Kick:8,"Kick & Mark":5,Mark:5,Torp:4,Banana:4};
const DEF={Tackle:4,Smother:4,"Tackle HTB":2,"Intercept Mark":4};
const UMP=["Not 15"];
const VAL={Handball:1,Bounce:1,Kick:1,"Kick & Mark":1,Mark:0,Torp:3,Banana:3};
function buildDeck(){let d=[];COLORS.forEach(col=>{Object.entries(MOM).forEach(([n,c])=>{for(let i=0;i<c;i++)d.push({name:n,color:col,value:VAL[n],type:"mom"});} );Object.entries(DEF).forEach(([n,c])=>{for(let i=0;i<c;i++)d.push({name:n,color:col,type:"def"});} );});UMP.forEach(n=>{for(let i=0;i<2;i++)d.push({name:n,color:"ump",type:"ump"});});d.push({name:"Siren",color:"wild",type:"wild"});return shuffle(d);}
const buildScore=()=>shuffle([..."GGGGGGG",..."BBBBBBBBBBBBB"]);/*score deck*/

/* ----- components ----- */
const Card=({c,onClick,back})=>{
  return back
   ?<div className="card back"><span>Deck</span></div>
   :<div className={"card "+c.color} onClick={onClick}><div className="card-title">{c.name}</div>{c.value!=null&&<div className="card-val">+{c.value}</div>}</div>;
};
function Zone({p,current}){const m=p.chain.reduce((s,c)=>s+(c.value||0),0);return(<div className={"zone "+(current?"highlight":"")}><strong>{p.name}</strong><br/>Score {p.score} • Mom {m}<div className="chain">{p.chain.map((c,i)=><Card key={i} c={c}/>)}</div></div>);}

/* ----- Board ----- */
function Board({onWin}){
  const [deck,setDeck]=useState(buildDeck());
  const [scores,setScores]=useState(buildScore());
  const [players,setPlayers]=useState(Array.from({length:4},(_,i)=>({id:i,name:i?`Bot ${i}`:"You",hand:[],chain:[],score:0})));
  const [turn,setTurn]=useState(0);
  const [actions,setActions]=useState(3);
  const [colour,setColour]=useState(null);

  const draw=(pl,n=1)=>{let d=[...deck];for(let i=0;i<n&&d.length;i++){pl.hand.push(d[0]);d=d.slice(1);}setDeck(d);};
  useEffect(()=>{if(players[0].hand.length===0){const arr=[...players];arr.forEach(pl=>draw(pl,7));setPlayers(arr);}},[]);
  useEffect(()=>{setPlayers(prev=>{const arr=[...prev];draw(arr[turn],3);return arr;});},[turn]);

  const protectedChain=ch=>last(ch)&&last(ch).name==="Mark";
  function applyDef(state,src,dst,idx){
    const cd=state[src].hand[idx];
    if(cd.type==="ump"&&cd.name==="Not 15"){
      const tgt=parseInt(prompt("Strip Mark from player (0-3)"));if(tgt<0||tgt>3||isNaN(tgt))return false;
      const ch=state[tgt].chain;if(protectedChain(ch)||last(ch)&&last(ch).name==="Kick & Mark"){ch.pop();state[src].hand.splice(idx,1);return true;}
      alert("No Mark/Kick & Mark on that chain.");return false;
    }
    const ch=state[dst].chain, l=last(ch);let ok=false;
    if(protectedChain(ch))return false;
    if(cd.name==="Tackle"&&l&&["Handball","Bounce"].includes(l.name)){ch.pop();ok=true;}
    else if(cd.name==="Smother"&&l&&["Handball","Kick"].includes(l.name)){ch.pop();ok=true;}
    else if(cd.name==="Tackle HTB"&&ch.length){state[dst].chain=[];ok=true;}
    else if(cd.name==="Intercept Mark"&&l&&l.name==="Kick"){state[src].chain.push(l);ch.pop();ok=true;}
    if(ok)state[src].hand.splice(idx,1);
    return ok;
  }

  const playCard=(i)=>{
    if(turn!==0)return;
    const arr=[...players],card=arr[0].hand[i],top=last(arr[0].chain);
    if(card.name==="Mark"&&(!top||top.name!=="Kick")){alert("Mark must follow a Kick.");return;}
    if(card.type==="mom"){
      if(colour&&card.color!==colour)return;
      arr[0].hand.splice(i,1);arr[0].chain.push(card);setColour(colour||card.color);setActions(a=>a-1);setPlayers(arr);
    }else{
      const ok=applyDef(arr,0,0,i);if(ok){setPlayers(arr);if(card.type!=="ump")setActions(a=>a-1);}
    }
  };

  const endTurn=()=>{setTurn((turn+1)%4);setActions(3);setColour(null);};

  return(<div className="board">
    {/* Deck pile */}
    <div className="deck-area"><Card back/><div style={{fontSize:14;marginTop:2}}>Deck&nbsp;{deck.length}</div></div>

    <h3>Turn: {players[turn].name}</h3>
    <div style={{display:"flex",justifyContent:"space-around"}}>{players.slice(1).map(p=><Zone key={p.id} p={p} current={turn===p.id}/>)}</div>
    <Zone p={players[0]} current={turn===0}/>
    <div className="hand-bar"><div className="hand">{players[0].hand.map((c,i)=><Card key={i} c={c} onClick={()=>playCard(i)}/>)}</div></div>
    {turn===0&&<button className="btn" onClick={endTurn}>End Turn ({actions})</button>}
  </div>);
}

/* ----- Start screen ----- */
function App(){const[play,setPlay]=useState(false);return play?<Board onWin={()=>setPlay(false)}/>:
  <div className="start"><img src="splash_card.png" className="splash-card"/><h1>MOMENTUM</h1><p>The Aussie Rules Card Game</p><button onClick={()=>setPlay(true)}>Play Game</button></div>;}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
